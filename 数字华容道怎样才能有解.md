

数字华容道怎样才能有解

火石
2018.07.06 00:37:34
字数 1,159
阅读 8,112
数字华容道，是在4x4的格子中，依次从左到右，从上到下放置1-15这15个数字。经过一定的随机，必须将这15个数字复原。每个数字只能向相邻的唯一空格移动。难度更高的，格子和数字会更多，比如5x5。

我在开发一个类数字华容道游戏时，发现自己3x3的格子，居然怎么都解不出来。比如：一排1、2、3，二排4、5、6，三排8，7。经过网上查询，才知道完全随机位置的数值华容道仅有50%的概率是有解的。而我就是用的完全随机方式去打乱次序。

网上有两篇文章说的很好，以下是根据这两篇文章的总结。

数字华容道必然有解的前提
首先，要弄清楚一个概念：逆序数。逆序数，即一个数字序列，将其中所有数字依次两两对比，若大数在前，小数在后，那么这就是一对逆序数。这里说到的逆序数，指的是数字序列中逆序数的数量。比如：上文提到的1、2、3、4、5、6、8、7，逆序数只有1个，即8和7。

另外，还有一点要提出来。一般来讲，复原状态（初始状态）的数字华容道，会有一个空格，一般会设置在最末行的右下角。但也可以根据实际的需求，设置在其他行。请留意，初始空格所在的行数，是决定是否有解的一个重要因素。

数字华容道，必然有解，只存在于如下3个细分情形：

若格子列数为奇数，则逆序数必须为偶数；
若格子列数为偶数，且逆序数为偶数，则当前空格所在行数与初始空格所在行数的差为偶数；
若格子列数为偶数，且逆序数为奇数，则当前空格所在行数与初始空格所在行数的差为奇数。
实际的推演涉及到我一时难以彻底理解的数学推算，我只能用浅显的方式来理解这个问题。

为什么？
首先，有解的前提在于：当前空格回到初始空格所在行数时，逆序数一定得是偶数！为什么，我不清楚。

要想把空格移动到初始空格所在行，必须进行若干次上下移动和若干次左右移动。

左右移动，不会改变逆序数；上下移动，若格子列数为奇数，则每次增减偶数个逆序数，若格子列数为偶数，则每次增减奇数个逆序数。

也就是说：

格子列数为奇数，怎么移动，都不会改变原始的逆序数。因为奇数加减偶数还是奇数，偶数加减偶数还是偶数。所以，只要保证逆序数是偶数即可，不必关心空格的位置。
格子列数为偶数，那么进行奇数次上下移动，会改变其逆序数的奇偶性。所以，如果当前逆序数是偶数，要想有解，就要保证实际上下移动会进行偶数次，也就是说空格所在行与初始空格所在行的差为偶数。
同理，若当前逆序数是奇数，要想有解，要进行奇数次的移动，才能保证最终逆序数是偶数。
如何转换逆序数奇偶性
具体实现应该很简单，不多说了，就说一点。如果想更改一个数字序列的逆序数的奇偶性，只需要调换一对逆序数的位置即可。

最后
可能是CS106A课程上的一句话，并不是原文：

程序员要在不理解内在实现逻辑的情况下，也能顺畅地使用别人的成果。

不理解没关系，会用就行。

参考文档：

https://www.guokr.com/article/54088/
用React写一个数字华容道，你需要知道的秘密 - 地铁上的小前端 - SegmentFault 思否
